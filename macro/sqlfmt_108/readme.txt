
                                                                                      2005-08-27

                          ========  「SqlFmt」取扱説明書   ========

                                       バージョン 1.08

目次

    001, はじめに
    002, 機能
    003, 特長
    004, 動作環境と制限
    005, インストール
    006, アンインストール
    007, 使用方法
    008, 便利な使い方の紹介
    009, 既知の障害について
    010, セット内容
    011, 使用許諾について
    012, 姉妹品の紹介


001, はじめに

    この度は「SqlFmt」をダウンロードして下さいまして誠に有難うございます。

    「SqlFmt」は、複雑なSQL文、及びPL/SQL文を読み下し易いスタイルへ整形する為の製品です。

    ご使用の前に本書の内容をよく読まれた上で、正しくお使い下さいますよう謹んでお願い申し上げます。

    なお、旧バージョンからこのバージョンへ移行されるお客様はこの文書よりも前にリリースノート
    (release.txt)をお読みください。リリースノートでは旧バージョンから追加された機能、バグの
    修正内容、廃止になったパラメータ、環境変数、未修正のバグに対する暫定的な対処方法などに
    ついて解説が有ります。


002, 機能

    引数で与えられたファイルに含まれるSQL文、及びPL/SQL文に対して、読み下し易くなるような字下げや
    改行などの加工を行い保存します。引数には実在するひとつ以上のファイル名、またはディレクトリ名を
    空白文字で区切って指定出来ます。ワイルドカード文字を使用して複数のファイルを一括して指定する
    こともできます。ファイル名またはディレクトリ名指定を省略するとクリップボード上にある SQLや
    PL/SQLを整形する事ができます。


003, 特長

    (1).
    SQL関数またはストアドプログラムの引数リスト、インライン・ビュー問合せ、副問合せ、及びPL/SQL
    の下記の構文中の「...」の部分について字下げを行います。入れ子構造部分の字下げは最大５１２
    レベルまで表現できます。
    ＜ストアドプログラム名＞ IS ... BEGIN ... EXCEPTION WHEN TEHN ... END;
    DECLARE ... BEGIN ... EXCEPTION WHEN TEHN ... END;
    IF THEN ... ELSIF THEN ... ELSE ... END IF;
    LOOP ... END LOOP;

    (2).
    引数リストの改行／字下げを行う基準について文脈が考慮されたインテリジェントな決定を
    下す事が出来ます。これにより入れ子構造をもたない単純な引数リストのストアドプログラムの
    呼び出しは改行／字下げを行わず、横方向に並べて見やすくすることが出来ます。尚、
    改行／字下げを行う基準は引数オプションの指定により省略時初期値を上書きすることが出来ます。

    (3).
    コマンド引数に -ixx オプションを指定すると(xxは 1 から 32 までの整数)ひとつ以上の連続する
    半角空白文字をインデント文字、文字列として使用できます（xx は半角空白文字のくり返し数です。
    0 を指定するとタブ文字をインデントに使用します）。

    (4).  【Ver.1.07 新機能】
    実行形式ファイルの他にこれと同等の機能を持つ、ダイナミックリンクライブラリ(以後 DLL と
    表記)を提供します。DLL に含まれるDLL関数をインポートすることにより、DLL 関数への
    インタフェース機能がある、お客様がお持ちのソフトウエアへ組込んで使用することが出来ます。
    あるいはお客様が C言語や Visual Basic  PL/SQL 等を使って作られたプログラムへ組込んで
    使用することも出来ます。

    (5).  【Ver.1.08 新機能】
    a. コマンド引数に -o オプションを指定すると標準入力から入力された整形前の文を入力し、
    標準出力へ整形済みの文を出力することが出来ます。
    b. TKPROF ユーティリティーが出力したレポートファイルを自動認識し SQLやPL/SQLブロックの
    部分を選択的に一括して整形する事が出来ます。


004, 動作環境と制限

    ・Windows95/98、WindowsNT、Windows2000、WindowsMe、WindowsXP 上で動作します。
    ・このプログラムは整形対象の文について字句解析や構文解析を行いません。したがって文としての
      妥当性はお客様自身で事前に判断する必要があります。SQLまたはPL/SQLとしての妥当性がない文を
      このプログラムへ入力したときは正しく動作しないことがあります。
    ・一部のSQL*Plus用のコマンド、例えば SET には対応していません。スクリプト・ファイル中にこれら
      のコマンドが含まれる場合、アプリケーション・エラーが発生することがあります。
    ・（TKPROF レポートファイルを除き）ファイル中には文をひとつだけ含めてください。
      複数のSQL文、PL/SQL文があるときは正しく動作致しません。


005, インストール

    ・旧版の「SqlFmt」が既にインストールされている場合にはその版の取扱説明書（readme.txt）に
      示されているアンインストール方法に従って完全にアンインストールしてください。
    ・製品に含まれるファイルを格納するためのディレクトリ（この文書の中で以後製品ディレクトリ
      と呼ぶ事にします）を任意に作成して下さい。製品ディレクトリへ書庫ファイル sqlfmt_xxx.LZH
      （xxxはバージョンによって異なる番号）の内容を解凍して下さい。


006, アンインストール

    ・製品ディレクトリを中に含まれるファイルごと削除します。
    ・.ini ファイルやレジストリは使用していませんのでキーの削除等は不要です。


007, 使用方法

    ・コマンドプロンプトを表示させた後、製品ディレクトリへカレントディレクトを移動させます。
    ・下記の書式でコマンドを入力し SqlFmt を実行します。

    sqlfmt
        [-h|--help]
        [-ixx|--indent_width=xx]
        [-cxx|--num_comma=xx]
        [-sxx|--part_size=xx]
        [-r|--recurently]
        [-o|--stdio]
        [[ディレクトリ名|ファイル名]...]

    ※引数はどのような順序で指定しても有効です。
    ※[]で囲まれた部分は省略可能なオプションを、一方、{}でで囲まれた部分は必須入力である
      オプションを意味します。,
    ※'|'(パイプ文字)で区切られた各選択肢はいずれかひとつが指定された時に有効であることを
      意味します。
    ※"..." は半角空白文字で引数を区切ることにより複数指定できることを意味します。

    -h, --help :
    このオプションを指定すると起動時のコマンド指定が表示されます。

    -ixx, --indent_width=xx :
    このオプションを指定すると xx に指定したくり返し数で連続する半角空白文字をインデント文字、
    文字列として使用できます。xx の有効な値の範囲は 1 から 32 までです。これ以外の値を指定する
    とタブ文字(0x09)が使用されます。このオプションを指定していない時の省略時初期値はタブ文字
    (0x09)です。

    -cxx, --num_comma=xx :
    このオプションを指定すると、xx に指定した数以上のカンマが括弧内に含まれる場合、カンマで
    区切られる各々の要素を新しい行に再配置します。このオプションを指定していない時の省略時
    初期値は 14 個です。

    -sxx, --part_size=xx :
    このオプションを指定すると、xx に指定したバイト数以上文字が括弧内に含まれる場合、カンマで
    区切られる各々の要素を新しい行に再配置します。このオプションを指定していない時の省略時
    初期値は 50 バイトです。

    -cxx と -sxx の指定は論理和で結合されます。

    -r, --recurently :
    このオプションを指定するとコマンド引数にディレクトリ名が指定された場合に限りそこに含まれる
    ファイルが整形されます。サブディレクトリも含まれる場合は再帰的に処理を繰り返します。
    [ディレクトリ名] が指定されていない時は特定の意味を持ちません。

    -o, --stdio :
    このオプションを指定すると標準入力から入力された整形前の文を入力し、標準出力へ整形済みの
    文を出力することが出来ます。パイプ型の動作をするプログラムを外部フィルタとして使用できる
    ようなエディタ(vim等)で使用すると便利です。例えば :%! sqlfmt -o をコマンドで入力します。

    ディレクトリ名, ファイル名：
    整形対象のSQLやPL/SQLが含まれる実在するスクリプトファイルかまたはこれを含むディレクトリ
    名をひとつ以上指定します。TKPROF レポートファイルの場合を除き、スクリプトファイルには
    SQLやPL/SQLをひとつだけ含めてください。
    複数のディレクトリ名やファイル名を指定する時は各々の間を半角空白文字で区切ってください。
    UNC（Universal Naming Convention）表記によるファイル名も指定できます。
    ワイルドカード文字を含むファイル名指定に対応しています。
    ディレクトリ名, ファイル名が省略された時はクリップボード上のSQLやPL/SQLを整形します。
    [-r|--recurently] が指定されていない時に[ディレクトリ名]を指定してもは特定の意味を
    持ちません。指定したファイルを直接書き換えますので、必要に応じてバックアップを取得して
    から実行してください。

    下記の何れかの条件に当てはまる場合は処理がスキップされます。
    ・{-r|--recurently}無しでディレクトリ名を指定した
    ・ファイルへの書き込み権が無い
    ・ファイルのサイズが０バイト

    また他のアプリケーションによってファイルが使用されている場合は下記のエラーが戻されます。
    「Error - ファイルのオープンに失敗しました。xxxx :Permission denied」
    （実際の xxxx の部分にはファイル名が表示されます）

    以下に実行例を示します。
    +---------------------------------------------------------------------------------------+
    |  C:\Borland\USER\sqlfmt>sqlfmt temp.sql                                         (a)   |
    |  SqlFmt version 1.08                                                            (b)   |
    |  Copyright (c) 2003 - 2005 Plumsix Co.,Ltd. All rights reserved.                      |
    |  正常終了しました。                                                             (c)   |
    |                                                                                       |
    |  C:\Borland\USER\sqlfmt>sqlfmt data\*.sql                                       (d)   |
    |  SqlFmt version 1.08                                                                  |
    |  Copyright (c) 2003 - 2005 Plumsix Co.,Ltd. All rights reserved.                      |
    |  data\1066761692.sql                                                            (e)   |
    |  data\1069974661.sql                                                                  |
    |  data\1078146205.sql                                                                  |
    |  data\1088412729.sql                                                                  |
    |  data\1114835931.sql                                                                  |
    |  5 個のファイルを整形しました。(合計 10,763 バイト)                             (f)   |
    |  正常終了しました。                                                                   |
    |                                                                                       |
    |  C:\Borland\USER\sqlfmt>sqlfmt -r data                                          (g)   |
    |  SqlFmt version 1.08                                                                  |
    |  Copyright (c) 2003 - 2005 Plumsix Co.,Ltd. All rights reserved.                      |
    |  data                                                                           (h)   |
    |  data\1066761692.sql                                                                  |
    |  data\1069974661.sql                                                                  |
    |  data\1078146205.sql                                                                  |
    |  data\1088412729.sql                                                                  |
    |  data\1114835931.sql                                                                  |
    |  1 個のディレクトリを参照しました。                                             (i)   |
    |  5 個のファイルを整形しました。(合計 10,763 バイト)                                   |
    |  正常終了しました。                                                                   |
    |                                                                                       |
    +---------------------------------------------------------------------------------------+

    (a)の例ではカレントディレクトリにあるスクリプトファイル temp.sql を処理対象としています。
    (b)プログラム名とバージョンが表示されます。
    (c)正常終了した場合には実行例のように表示されます。他に「異常終了しました。」と表示される
      場合もあります。
    (d)の例ではサブディレクトリ data にあるファイルのうち拡張子が *.sql のファイルを処理対象
      としています。
    (e)処理中のファイル名が表示されます。複数のファイルが対象となる場合はファイル名の文字コード
      の昇順に処理されます。
    (f)処理したファイルの個数と処理したファイルの合計バイト数を表示します。
    (g) -r オプションを使用し data ディレクトリ下にあるファイルの整形を行います。
    (h)コマンド引数で指定したディレクトリとそのディレクトリに含まれるサブディレクトリが列挙
      されます。
    (i)参照されたディレクトリとサブディレクトリの合計数が示されます。


008, 便利な使い方の紹介

    コマンド入力の他にマウスのポップアップ・メニュー（右ボタンクリックで開くメニュー）から
    起動させる方法もあります。 SendTo フォルダへ sqlfmt.exe のショートカットを登録しておくと
    エクスプローラ上で整形対象のスクリプトを選択した後、

    マウスの右ボタンクリック → 送る(N) → sqlfmt.exe へのショートカット

    の操作で手軽に起動することも出来ます。またsqlfmt.exe もしくはこのファイルへのショートカット
    アイコンへ整形対象のスクリプトのアイコンをドラッグ＆ドロップしても処理できます。

    SendTo フォルダは
    WindowsNT/95 では %SystemRoot%\Profiles\ユーザ名
    Windows2000/XP では %USERPROFILE%
    に存在します。


009, 既知の障害について

    確認済みの障害について現象と対策を以下に示します。

    障害１
    パッケージ・カーソルの前方にプロシージャ、またはファンクションの宣言や定義があると異常終了
    する。
    対策
    プロシージャ、またはファンクションの宣言や定義をパッケージ・カーソルの前方に置かない様に
    記述してください。


010, セット内容

    配布用の書庫ファイル「sqlfmt_xxx.LZH（xxxはバージョンによって異なる番号）」には以下のファイルが
    含まれています。
    -------------------------------------------------------------------------------------------------
    ファイル名 （ABC順）           説明
    ------------------------------ ------------------------------------------------------------------
     1.psExpFuncs.h                sqlfmt.dll に含まれるDLL関数のプロトタイプ
     2.readme.txt                  「SqlFmt」取扱説明書（このファイル）
     3.release.txt                 リリース・ノート （readme.txt を読む前にお読みください。）
     4.sqlfmt.dll                  SqlFmt 製品プログラム本体 (DLL形式)
     5.sqlfmt.exe                  SqlFmt 製品プログラム本体 (EXE形式)
     6.sqlfmt.lib                  sqlfmt.dll のインポート・ライブラリ
     7.tStmtStyle.h                DLL関数 iFmtStmt() を使用するときの構造体定義
     8.sample\c                    C言語へDLL関数をインポートして使用するサンプル
     9.sample\hm                   秀丸エディタへDLL関数をインポートして使用するサンプル
    10.sample\plsql                PL/SQLの外部プロシージャとしてDLL関数をインポートして使用するサンプル
    11.sample\vb                   VB へDLL関数をインポートして使用するサンプル
    -------------------------------------------------------------------------------------------------


011, 使用許諾について

    この製品の使用開始を以ってこの章に定められた使用許諾条件にお客様が合意されたものとみなします。
    従いまして使用許諾条件に合意されない場合は直ちに使用を停止し製品を破棄しなければなりません。
    このソフトウエアの著作権は弊社が保有いたします。従いまして客様はこのソフトや添付された
    ドキュメントを一般の著作物と同様に取り扱わなければなりません。
    お客様は本ソフトウェアの修正、改造、翻案、解読、逆コンパイル、逆アセンブル、あるいはソース
    コードを暴くことを試みてはなりません。
    入手した時と同じ名前の同じ書庫形式ファイルに「009, セット内容」に含まれるもの全てを収録した
    媒体のみ再配布することを許可します。この媒体には見やすい箇所に弊社の著作権表示を行ってくだ
    さい（この文書の末尾にあるものと同じ著作権表示を使用してください）。再配布に必要な送料、
    手数料、媒体の実費以外の金品を配布先に請求してはなりません。
    このソフトを実行したことによって惹き起こされた損害に対して弊社は如何なる責任も負いません。
    またパフォーマンス、処理結果、商品性、用途への適合性、第三者の権利の非侵害について一切保証
    いたしません。また弊社がこのソフトウエアの障害についての報告を受けたとしても是正する義務を
    負わないものと致します。
    出版物や公衆が閲覧できるWorld Wide Webページにこのソフトウエアに関する記事を掲載する時は
    事前に弊社の担当へご連絡下さい（ hirayama@plumsix.co.jp  担当：平山）。


012, 姉妹品の紹介

    弊社では本品の他にもデータベースアプリケーションの運用に役立つソフトを公開しております。
    いずれも無料で３０日間試用が出来るライセンスがついています。この機会にぜひお試しください。

    ---------------------------------------------------------------------------------------------
    名称       目的                                                            価格 (消費税込み)
    ---------- --------------------------------------------------------------- ------------------
    Applied DD 表データのCSVファイル出力とSQL*Loader用制御ファイル自動生成     \6,090-
    SqlArea    コマンド一発で非効率SQLのランキングを作成                       \5,040-
    ---------------------------------------------------------------------------------------------
   (上表の価格には 1 ライセンス当たりの対価とその消費税を含みます)

    下記の URL から入手できます。

    株式会社ベクター http://www.vector.co.jp/


Microsoftは、Microsoft Corporationの登録商標であり、
Windows、Windows NT、Windows XP は、Microsoft Corporationの登録商標です。
秀丸エディタは有限会社サイトー企画(http://hide.maruo.co.jp/)の製品です。

他のブランドおよび製品名は、各社の商標および登録商標です。

Copyright (c) 2003 - 2005 Plumsix Co.,Ltd. All rights reserved.
